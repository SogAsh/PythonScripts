ManualTestsHelper - скрипты, которые автоматизируют рутинные действия при проверках на виндовой кассе. 

Сами скрипты написаны на питоне, а запускаются горячими клавишами благодаря AutoHotKey.

Пожелания и предложения пишите автору: https://staff.skbkontur.ru/profile/mnoskov

## Как запустить

1. Установите AutoHotKey: https://www.autohotkey.com/
2. Установите питон третьей версии. Обязательно поставьте галочку в "Добавить в Path": https://www.python.org/downloads/
3. Проверьте, что питон работает: откройте командную строку, напишите python и нажмите Enter. Должны появиться такие знаки в начале строки: >>>. А если открылся Microsoft Store, в меню Пуск найдите «Управление псевдонимами выполнения приложений» и отключите переключатель для python.
3. Выкачайте этот репозиторий 
4. В папке helpers запустите от администратора libinstaller.bat. Он установит необходимые библиотеки + создаст файл data.json.
5. В файле data.json: убедитесь, что перечислен ваш жесткий диск, на котором лежит Касса. Остальные строки заполняются сами.
6. Запустите kmk_hotkeys.ahk от администратора (так все скрипты тоже будут запускаться от администратора)

Простого способа запускать kmk_hotkeys.ahk автоматически при включении ПК пока нет. Автозагрузка не работает из-за необходимости админских прав. Обходной путь - настроить правило в планировщике задач Windows. Его можно найти в меню Пуск, и он интуитивно понятен.

## Как пользоваться

После запуска файла .ahk можно нажимать на горячие клавиши.

| Горячие клавиши | Действие | Пояснение|
|----:|:----:|:----------|
|ALT + стрелка вниз  | Остановка службы SKBKontur.Cashbox |  |
|ALT + стрелка вверх | Запуск службы SKBKontur.Cashbox |  |
|ALT + d |Удаление базы данных кассы | Удаление папки db из папки Cashbox |
|ALT + c | Удаление кассы | Удаление папки Cashbox |
|ALT + p | Вставить cashboxId из буфера в файл data.json | Чтобы сгенерировать токен для этой КМК в следующем скрипте |
|ALT + t| Генерация нового токена| Код активации сгенерируется для кассы, которая указана в файле data.json |
|ALT + 1| Переключение на стейджинг-1 | В конфиге адрес лояльности заменится на: market.testkontur... |
|ALT + 2 | Переключение на стейджинг-2  | В конфиге адрес лояльности заменится на: market-dev.testkontur... |
|ALT + 9 | Переключение на прод  | В конфиге адреса заменятся на: market.kontur... |
|ALT + o | Изменение настройки переноса остатков | MoveRemainsToNextShift - заменяем настройку с тру на фолс или с фолс на тру |
|ALT + i | Скопировать в буфер id текущей кассы | CashboxId берём из таблицы CashboxState в БД |
|ALT + - | Сделать текущую смену > 24 часов | В БД изменится дата начала последней смены |
|ALT + e | Сделать последний чек продажи незареганным | В БД будет kkmRegistrationStatus = "Error"  и correctionReceiptId = null |
|ALT + g | Сгенерировать guid | Корректный guid окажется в буфере обмена |
|ALT + k | Выбрать ККТ и терминалы | Если указали 1 ККТ, включится режим 1ЮЛ, если 2ККТ - режим 2ЮЛ. Про 2ЮЛ важно знать:  1) первая ККТ должна быть для ЮЛ с ИНН 6699000000, вторая ККТ — для ИП с ИНН 992570272700. 2) У всех товаров проставится LegalEntityId первого ЮЛ, у товаров с суффиксом _2ЮЛ - второго ЮЛ (если таких нет - у первого товара). Названия этих товаров будут в консоли. 3) Манипуляции с 2ЮЛ желательно проделывать при закрытой смене|

Изменение настроек происходит на КС, поэтому после выполнения команды надо синхронизироваться.

Также работает автозамена строк. Просто напишите ключ где угодно, например, в строке браузера, — и поставьте завершающий символ, например, нажмите Enter. 
Подставится значение:

:white_check_mark: adm1 - https://market.testkontur.ru/AdminTools

:white_check_mark: adm2 - https://market-dev.testkontur.ru/AdminTools

:white_check_mark: csadm1 - https://market.testkontur.ru/cashboxApi/admin/web/cashbox/

:white_check_mark: csadm2 - https://market-dev.testkontur.ru/cashboxApi/admin/web/cashbox/

:white_check_mark: csdoc - https://developer.kontur.ru/


____

:cat: *Расширяйте набор скриптов и горячих клавиш по аналогии и подстраивайте их под себя. 
Или хотя бы расказывайте, чего не хватает :)* 

